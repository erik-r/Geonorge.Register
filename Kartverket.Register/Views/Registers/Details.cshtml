@model Kartverket.Register.Models.Register
﻿@using Kartverket.Register.Helpers
@using PagedList;

@{
    ViewBag.Title = @Model.name;
}

@section breadcrumb {
    <li class="active">@Html.DisplayFor(model => model.name)</li>
}

<script>
    $(function () {
        var menu_state = localStorage.setItem("navtabselected", "gjeldende");
    }
)
</script>

<div class="page-header">
    <h2 class="h-md" id="registerName">@Html.DisplayFor(model => model.name)</h2>
    <hr>
</div>
<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
    <div class="col-no-padding-xs col-xs-12 col-sm-10 col-md-10 col-lg-10">
        ID: <a href="/register/@Model.seoname">http://@Request.Url.Host@Request.Url.LocalPath </a>
        <p>
            @Html.DisplayFor(model => model.description)
        </p>

    </div>
    <div class="col-no-padding-xs col-xs-12 col-sm-3 col-md-2 col-lg-2">
        <span class="small">Registrert: @Html.DisplayFor(model => model.dateSubmitted)</span><br />
        <span class="small">Oppdatert: @Html.DisplayFor(model => model.modified)</span>
    </div>

    @{
        var page = ViewBag.page;
        var currentFilter = ViewBag.currentFilter;
        var sortering = Model.items.OrderBy(o => o.name).ToList();
        var sorteringRegister = Model.subregisters.OrderByDescending(s => s.name).ToList();
        int pageSize = 50;
        int pageNumber = (page ?? 1);
        var search = ViewBag.search;

        if (Model.containedItemClass != "Register")
        {
            sortering = HtmlHelperExtensions.SortingRegisterItems(Model, ViewBag.SortOrder);
        }
        else
        {
            sorteringRegister = HtmlHelperExtensions.SortingRegisters(Model, ViewBag.SortOrder);
        }
    }



    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="page-header">
            <hr>
        </div>

        @if (Model.containedItemClass == "Organization")
        {
            @Html.Partial("_organization", sortering.ToPagedList(pageNumber, pageSize))
        }
        @if (Model.containedItemClass == "CodelistValue")
        {
            @Html.Partial("_codelistValue", sortering.ToPagedList(pageNumber, pageSize))
        }
        @if (Model.containedItemClass == "Document")
        {
            @Html.Partial("_documents", sortering.ToPagedList(pageNumber, pageSize))
        }
        @if (Model.containedItemClass == "Dataset")
        {
            @Html.Partial("_dataset", sortering.ToPagedList(pageNumber, pageSize))
        }
        @if (Model.containedItemClass == "EPSG")
        {
            @Html.Partial("_epsg", sortering.ToPagedList(pageNumber, pageSize))
        }
        @if (Model.containedItemClass == "Register")
        {
            if (ViewBag.SortOrder == "name_desc")
            {
                @Html.Partial("_subregister", sorteringRegister.ToPagedList(pageNumber, pageSize))
            }
            else if (ViewBag.SortOrder == "submitter")
            {
                @Html.Partial("_subregister", sorteringRegister.ToPagedList(pageNumber, pageSize))
            }
            else if (ViewBag.SortOrder == "submitter_desc")
            {
                @Html.Partial("_subregister", sorteringRegister.ToPagedList(pageNumber, pageSize))
            }
            else if (ViewBag.SortOrder == "status")
            {
                @Html.Partial("_subregister", sorteringRegister.ToPagedList(pageNumber, pageSize))
            }
            else if (ViewBag.SortOrder == "status_desc")
            {
                @Html.Partial("_subregister", sorteringRegister.ToPagedList(pageNumber, pageSize))
            }
            else if (ViewBag.SortOrder == "dateSubmitted")
            {
                @Html.Partial("_subregister", sorteringRegister.ToPagedList(pageNumber, pageSize))
            }
            else if (ViewBag.SortOrder == "dateSubmitted_desc")
            {
                @Html.Partial("_subregister", sorteringRegister.ToPagedList(pageNumber, pageSize))
            }
            else if (ViewBag.SortOrder == "modified")
            {
                @Html.Partial("_subregister", sorteringRegister.ToPagedList(pageNumber, pageSize))
            }
            else if (ViewBag.SortOrder == "modified_desc")
            {
                @Html.Partial("_subregister", sorteringRegister.ToPagedList(pageNumber, pageSize))
            }
            else if (ViewBag.SortOrder == "dateAccepted")
            {
                @Html.Partial("_subregister", sorteringRegister.ToPagedList(pageNumber, pageSize))
            }
            else if (ViewBag.SortOrder == "dateAccepted_desc")
            {
                @Html.Partial("_subregister", sorteringRegister.ToPagedList(pageNumber, pageSize))
            }
            else
            {
                @Html.Partial("_subregister", sorteringRegister.ToPagedList(pageNumber, pageSize))
            }
        }
    </div>

    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 hidden-print">
        @if (Request.IsAuthenticated)
        {
            if (HtmlHelperExtensions.accessRegister(Model))
            {
                if (Model.containedItemClass == "Document")
                {
                    <a class="btn btn-default btn-space pull-right" href="/dokument/@Model.seoname/ny">Foreslå nytt dokument i @Model.name </a>
                }
                if (Model.containedItemClass == "CodelistValue")
                {
                    <a class="btn btn-default btn-space pull-right" href="/kodeliste/@Model.seoname/ny">Foreslå ny kode i @Model.name </a>
                }
                if (Model.containedItemClass == "Register")
                {
                    <a class="btn btn-default btn-space pull-right" href="/subregister/@Model.seoname/ny">Foreslå nytt register i @Model.name </a>
                }
            }
            
            if (Html.IsGeonorgeAdmin(System.Security.Claims.ClaimsPrincipal.Current.Claims))
            {
                if (Model.containedItemClass == "Organization")
                {
                    <a class="btn btn-default btn-space pull-right" href="/organisasjoner/@Model.seoname/ny">Foreslå ny organisasjon i @Model.name </a>
                }
                if (Model.containedItemClass == "Dataset")
                {
                    <a class="btn btn-default btn-space pull-right" href="/dataset/@Model.seoname/ny">Foreslå nytt datasett i @Model.name </a>
                }
                if (Model.containedItemClass == "EPSG")
                {
                    <a class="btn btn-default btn-space pull-right" href="/epsg/@Model.seoname/ny">Foreslå ny epsg kode i @Model.name </a>

                }
                <a class="btn btn-default btn-space pull-right" href="/endre/@Model.seoname">Rediger</a>
                <a class="btn btn-default btn-space pull-right" href="/slett/@Model.seoname">Slett</a>
            }
        }
        <a class="hidden-print" href="/">Tilbake</a>
    </div>
</div>
