@model Kartverket.Register.Models.ViewModels.ShowDatasetCoverageViewModel
@{
    ViewBag.Title = "Dekningsoversikt";
}

<h2>Dekningskart for DOK-datasett</h2>

<form action="@Request.Url.LocalPath" method="get">
    <div class="row">
        <div class="col-md-2">
            <div class="chosen-container chosen-container-single">
                <label for="State" class="sr-only">Velg fylke:</label> @Html.DropDownList("fylke", (SelectList)ViewBag.States, "Velg fylke")
            </div>
        </div>
        <div class="col-md-5">
            <div class="chosen-container chosen-container-single">
                <label for="Dataset" class="sr-only">Velg fylke:</label> @Html.DropDownList("dataset", (SelectList)ViewBag.Datasets, "Velg datasett")
            </div>
        </div>
        <div class="col-md-3">
            <input type="submit" value="Vis dekningskart for valgt fylke" class="btn btn-default" />
        </div>
    </div>
</form>


<div id="map" class="col-sm-12 col-md-12" style="height: 600px;">

</div>

<script type="text/javascript">
    (function () {

        var crs = L.CRS.proj4js('EPSG:32633', '+proj=utm +zone=33+ellps=WGS84 +datum=WGS84 +units=m +no_defs', new L.Transformation(1, 2500000, -1, 9045984));
        crs.scale = function (zoom) {
            return 1 / (21674.7100160867 / Math.pow(2, zoom));
        };

        var map = L.map('map', { crs: crs, continuousWorld: true }).setView([64.5, 10], 5);

        var southWest = L.latLng(@Model.StateBoundingBox.South, @Model.StateBoundingBox.West),
        northEast = L.latLng(@Model.StateBoundingBox.North, @Model.StateBoundingBox.East),
        bounds = L.latLngBounds(southWest, northEast);
        map.fitBounds(bounds);
            
        /*
            var baseLayer1 = new L.TileLayer.WMS("http://openwms.statkart.no/skwms1/wms.europa", {
                layers: 'Europa_WMS',
                format: 'image/png',
                attribution: "Kartverket",
                crs: crs
            }).addTo(map);
        */
        var baseLayer2 = new L.TileLayer.WMS("http://wms.geonorge.no/skwms1/wms.topo2", {
            layers: 'topo2_WMS',
            format: 'image/png',
            attribution: "Kartverket",
            version: '1.3.0'
        }).addTo(map);

        var coverageLayer = new L.TileLayer.WMS("http://openwms.statkart.no/skwms1/wms.gp_dek_oversikt?datasett=korallrev", {
            layers: 'datasett_dekning',
            format: 'image/png',
            attribution: "Kartverket",
            transparent: true,
            opacity: 0.7
        }).addTo(map);
       
        /*
        var countyNames = new L.TileLayer.WMS("http://wms.geonorge.no/skwms1/wms.abas?", {
            layers: 'Kommunenavn',
            format: 'image/png',
            transparent: true,
            attribution: "Kartverket",
        }).addTo(map);
    */

    }());
</script>