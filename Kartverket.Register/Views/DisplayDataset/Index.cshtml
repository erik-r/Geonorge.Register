@model List<Kartverket.DOK.Models.Dataset>
@{
    ViewBag.Title = "Det offentlige kartgrunnlaget (DOK)";
}
<div class="page-header">
    <h1 class="h-md">@ViewBag.Title</h1>
    <hr>
</div>
    @if (Model != null)
    {
        <div id="dataset">

            <label>Søk: <input class="search" /></label>
            <button id="reset-search" class="btn btn-xs"><span class="glyphicon glyphicon-remove"></span> tøm søk</button>

            <table class="table table-striped table-bordered" style="background-color: white">
                <thead>
                    <tr>
                        <th><a href="" data-sort="name" data-order="asc">Tittel</a></th>
                        <th><a href="" data-sort="publisher" data-order="asc">Eier / leverandør</a></th>
                        <th><a href="" data-sort="themegroup" data-order="asc">Temagruppe</a></th>
                        <th>Beskrivelse</th>
                        <th style="width: 80px">Metadata</th>
                        <th style="width: 90px">Produktark</th>
                        <th style="width: 90px">Kartografi</th>
                        <th style="width: 110px">Produkt-spesifikasjon</th>
                        <th>SOSI</th>
                        <th>WMS</th>
                        <th><a href="" data-sort="status" data-order="asc">Status</a></th>
                    </tr>
                </thead>
                <tbody class="list">
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td><b class="name">@item.Name</b></td>
                            <td class="publisher">@item.Publisher</td>
                            <td class="themegroup">@item.ThemeGroup.Name</td>
                            <td>
                                @if (item.Description != null)
                                {
                                    <p id="shortdesc">
                                        @if (item.Description.Length < 80)
                                        {
                                            @item.Description.Substring(0, item.Description.Length)
                                        }
                                        else
                                        {
                                            @item.Description.Substring(0, 80)<text>...</text>
                                        }
                                        <a href="@Url.Action("Display", "DisplayDataset", new { id = @item.Id, name=@item.ToSeoUrl()})">vis mer info</a>
                                    </p>
                                }
                            </td>
                            <td>
                                @if (!string.IsNullOrWhiteSpace(item.MetadataUrl))
                                {
                                    <a href="@item.MetadataUrl" class="btn btn-sm btn-fresh-green" title="Vis metadata for @item.Name"><span class="glyphicon glyphicon-globe"></span> Vis</a>
                                }
                            </td>
                            <td>
                                @if (!string.IsNullOrWhiteSpace(item.ProductSheetUrl))
                                {
                                    <a href="@item.ProductSheetUrl" class="btn btn-sm btn-fresh-blue" title="Last ned produktark for @item.Name"><span class="glyphicon glyphicon-info-sign"></span> Hent</a>
                                }
                            </td>
                            <td>
                                @if (!string.IsNullOrWhiteSpace(item.PresentationRulesUrl))
                                {
                                    <a href="@item.PresentationRulesUrl" class="btn btn-sm btn-fresh-green" title="Last ned kartografi for @item.Name"><span class="glyphicon glyphicon-picture"></span> Hent</a>
                                }
                            </td>
                            <td>
                                @if (!string.IsNullOrWhiteSpace(item.ProductSpecificationUrl))
                                {
                                    <a href="@item.ProductSpecificationUrl" class="btn btn-sm btn-fresh-blue" title="Last ned produktspesifikasjon for @item.Name"><span class="glyphicon glyphicon-list-alt"></span> Hent</a>
                                }
                            </td>
                            <td>
                                @if (!string.IsNullOrWhiteSpace(item.DistributionFormat) && item.DistributionFormat.Trim().ToLower().Equals("sosi"))
                                {
                                    <text>ja</text>
                                }
                                else
                                {
                                    <text>nei</text>
                                }
                            </td>
                            <td>
                                @if (!string.IsNullOrWhiteSpace(item.WmsUrl))
                                {
                                    <a href="@item.WmsUrl">WMS</a>
                                }
                            </td>
                            <td class="status">
                                @if (item.status != null)
                                {
                                    @item.status.description
                                }
                            </td>

                        </tr>
                    }
                </tbody>
            </table>
        </div>


    }

    @section scripts {
        <script src="http://listjs.com/no-cdn/list.js"></script>
        <script src="~/Scripts/jquery.stickytableheaders.js"></script>
        <script>
            var offset = 0;
            $("html:not(.legacy) table").stickyTableHeaders({ fixedOffset: offset });


            var options = {
                valueNames: ['name', 'publisher', 'themegroup', 'status']
            };

            var datasetList = new List('dataset', options);

            $(function () {
                $('#dataset th a[data-sort]').click(function (event) {
                    event.preventDefault();
                    var column = $(this).data('sort');
                    var order = $(this).data('order');
                    datasetList.sort(column, { order: order });

                    $('#dataset th a[data-sort]').removeClass('sorted-asc').removeClass('sorted-desc');

                    if (order == 'asc') {
                        $(this).data('order', 'desc');
                        $(this).removeClass('sorted-desc').addClass('sorted-asc').attr('title', 'Sortert fra A til Å');
                    } else {
                        $(this).data('order', 'asc');
                        $(this).removeClass('sorted-asc').addClass('sorted-desc').attr('title', 'Sortert fra Å til A');;
                    }
                });

                $('#reset-search').click(function (event) {
                    event.preventDefault();
                    $('input.search').val("");
                    datasetList.search();
                });

            });


        </script>
    }
